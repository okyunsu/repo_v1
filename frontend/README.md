## Getting Started

First, run the development server:

# 백엔드 개발자를 위한 초기 설정 가이드

프론트엔드 프로젝트를 클론하여 개발 환경을 구성하는 단계별 가이드입니다.

## 사전 요구사항

- [Git](https://git-scm.com/downloads) 설치
- [Node.js](https://nodejs.org/) 16.x 이상 설치
- [pnpm](https://pnpm.io/installation) 설치 (`npm install -g pnpm`)

## 프로젝트 설정 단계

### 1. 프로젝트 클론

```bash
# 프로젝트 저장소 클론
git clone [프로젝트_저장소_URL]

# 프로젝트 디렉토리로 이동
cd [프로젝트_디렉토리_이름]
```

### 2. 의존성 설치

```bash
# pnpm을 사용하여 의존성 설치
pnpm install
```

### 3. 환경 변수 설정

```bash
# .env.local 파일 생성 (.env.example을 참고하여 작성)
cp .env.example .env.local

# 텍스트 에디터로 .env.local 파일 열기 및 수정
# 백엔드 API URL 및 기타 필요한 환경 변수 설정
```

주요 환경 변수:
- `VITE_API_BASE_URL`: 백엔드 API의 기본 URL (예: http://localhost:8000/api)
- `VITE_ACCESS_TOKEN_EXPIRE_TIME`: 액세스 토큰 만료 시간(초)
- `VITE_AUTH_COOKIE_DOMAIN`: 쿠키 도메인 설정
- `VITE_AUTH_SECURE_COOKIE`: 개발 환경에서는 false, 프로덕션에서는 true

### 4. 개발 서버 실행

```bash
# 개발 서버 시작
pnpm dev
```

개발 서버는 기본적으로 http://localhost:3000 에서 실행됩니다.

## 백엔드 개발 준비

### 1. API 엔드포인트 구현

프론트엔드가 기대하는 API 엔드포인트를 백엔드에 구현합니다:

- `/auth/login` - 로그인 처리
- `/auth/refresh` - 토큰 갱신
- `/auth/logout` - 로그아웃 처리
- 기타 애플리케이션별 API 엔드포인트

### 2. CORS 설정 구성

백엔드 서버에 다음 CORS 설정을 추가합니다:

```
Access-Control-Allow-Origin: http://localhost:3000
Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
Access-Control-Allow-Headers: Content-Type, Authorization
Access-Control-Allow-Credentials: true
```

### 3. 인증 시스템 구현

README.md에 기술된 인증 흐름에 따라 백엔드 인증 시스템을 구현합니다:

- 액세스 토큰 및 리프레시 토큰 발급
- 토큰 검증 및 갱신 처리
- 인증 미들웨어 구현

## 프론트엔드-백엔드 통합 테스트

1. 프론트엔드 개발 서버 실행 (`pnpm dev`)
2. 백엔드 서버 실행 (백엔드 프로젝트의 실행 명령어 사용)
3. 로그인 기능 테스트
4. API 엔드포인트 통합 테스트

## 문제 해결

### 일반적인 문제 및 해결 방법

1. **CORS 오류**: 백엔드 CORS 설정이 올바르게 구성되었는지 확인
2. **404 Not Found**: API 경로가 프론트엔드 요청과 일치하는지 확인
3. **401 Unauthorized**: 토큰 검증 로직 및 인증 헤더 형식 확인
4. **의존성 문제**: Node.js 버전 확인 및 `pnpm install` 재실행

문제가 지속될 경우 프론트엔드 개발자에게 문의하세요.

---

# 액세스 토큰 & 리프레시 토큰 인증 시스템

## 목차
1. [개요](#개요)
2. [인증 흐름](#인증-흐름)
   - [초기 로그인](#초기-로그인)
   - [API 요청 시 토큰 사용](#api-요청-시-토큰-사용)
   - [액세스 토큰 만료 감지](#액세스-토큰-만료-감지)
   - [토큰 갱신 프로세스](#토큰-갱신-프로세스)
   - [토큰 갱신 후 처리](#토큰-갱신-후-처리)
3. [백엔드 구현 요구사항](#백엔드-구현-요구사항)
4. [보안 고려사항](#보안-고려사항)

## 개요

본 시스템은 액세스 토큰과 리프레시 토큰을 활용한 이중 토큰 인증 체계를 구현합니다. 이 방식은 보안성을 강화하면서도 사용자 경험을 저하시키지 않는 균형점을 제공합니다.

- **액세스 토큰**: 짧은 유효 기간을 가지며 API 요청 인증에 사용
- **리프레시 토큰**: 상대적으로 긴 유효 기간을 가지며, 액세스 토큰 갱신에 사용

## 인증 흐름

### 초기 로그인

1. 사용자가 로그인 폼에 자격 증명(이메일/비밀번호)을 입력하면 프론트엔드에서 `authService.login()` 함수가 호출됩니다.
2. 백엔드는 인증 성공 시 응답에 두 가지 토큰을 포함합니다:
   - **액세스 토큰**: JSON 응답으로 반환되며, 프론트엔드에서 클라이언트 측 로컬 스토리지에 저장
   - **리프레시 토큰**: HTTP-Only, Secure 속성이 설정된 쿠키로 반환되어 XSS 공격으로부터 보호 (클라이언트 JavaScript에서 직접 접근 불가)

### API 요청 시 토큰 사용

1. 프론트엔드에서 모든 API 요청은 구성된 `axiosInstance`를 통해 이루어집니다.
2. 요청 인터셉터는 자동으로 다음 작업을 수행합니다:
   - 로컬 스토리지에서 액세스 토큰을 검색
   - 검색된 토큰을 `Authorization: Bearer {token}` 형식의 HTTP 헤더에 추가
   - `withCredentials: true` 설정으로 쿠키(리프레시 토큰)가 요청과 함께 전송되도록 함

### 액세스 토큰 만료 감지

1. 백엔드에서 401(Unauthorized) 상태 코드를 반환하면, 이는 액세스 토큰이 만료되었음을 의미합니다.
2. 응답 인터셉터가 401 오류를 감지하고 토큰 갱신 로직을 자동으로 시작합니다.

### 토큰 갱신 프로세스

1. `authService.refreshToken()` 함수가 호출되어 `/auth/refresh` 엔드포인트로 요청을 전송합니다.
2. 이 요청은 브라우저에 의해 HTTP-Only 쿠키에 저장된 리프레시 토큰을 자동으로 포함합니다.
3. 백엔드는 다음 과정을 수행합니다:
   - 리프레시 토큰의 유효성 검증
   - 유효하다면 새 액세스 토큰 발급 (선택적으로 새 리프레시 토큰도 발급 가능)

### 토큰 갱신 후 처리

#### 성공 시:
1. 새 액세스 토큰을 로컬 스토리지에 저장합니다.
2. 실패했던 원래 API 요청을 새 토큰으로 자동 재시도합니다.
3. 대기 중이던 다른 API 요청들도 새 토큰으로 자동으로 재시도됩니다.

#### 실패 시:
1. 리프레시 토큰이 만료되었거나 유효하지 않은 경우 발생합니다.
2. `useAuthStore.handleAuthFailure()` 함수가 호출되어 사용자를 로그아웃 처리합니다.
3. 사용자는 로그인 페이지로 리다이렉트되며, 현재 URL은 인증 후 복귀를 위해 `returnUrl` 쿼리 파라미터로 저장됩니다.

## 백엔드 구현 요구사항

### 1. 로그인 엔드포인트 (`/auth/login`)
- **요청**: 사용자 자격 증명(이메일/비밀번호)
- **응답**: 
  - 액세스 토큰: JSON 형식으로 반환
  - 리프레시 토큰: HTTP-Only, Secure 쿠키로 설정
  - 토큰 만료 시간 정보(선택사항)

### 2. 토큰 갱신 엔드포인트 (`/auth/refresh`)
- **요청**: 리프레시 토큰(쿠키에서 자동으로 전송)
- **응답**: 
  - 새 액세스 토큰: JSON 형식으로 반환
  - 새 리프레시 토큰(선택사항): HTTP-Only 쿠키로 갱신

### 3. 로그아웃 엔드포인트 (`/auth/logout`)
- **기능**: 
  - 리프레시 토큰 무효화(데이터베이스에서 토큰 삭제 또는 블랙리스트에 추가)
  - 리프레시 토큰 쿠키 제거(만료된 쿠키 설정)

### 4. 인증 검증 미들웨어
- 모든 보호된 API 엔드포인트에 적용
- 액세스 토큰 유효성 검증 수행
- 검증 실패 시:
  - 토큰 만료: 401 상태 코드 반환
  - 유효하지 않은 토큰: 403 상태 코드 반환

## 보안 고려사항

1. **액세스 토큰 유효 기간**: 짧게 설정 권장(15~30분)하여 탈취 시 위험 최소화
2. **리프레시 토큰 저장**: 데이터베이스에 저장하여 필요 시 무효화 가능하도록 구현
3. **토큰 회전(Rotation)**: 리프레시 토큰 사용 시마다 새로운 리프레시 토큰 발급 고려
4. **CSRF 보호**: 리프레시 토큰 요청 시 CSRF 토큰 검증 추가 고려
5. **IP 바인딩**: 리프레시 토큰에 사용자 IP 정보 바인딩 고려(선택사항)

## 대시보드 워크플로우 및 인증 흐름도

## 목차
1. [대시보드 워크플로우](#대시보드-워크플로우)
   - [초기 로드 시나리오](#초기-로드-시나리오)
   - [컴포넌트 상호작용](#컴포넌트-상호작용)
   - [데이터 요청 및 갱신](#데이터-요청-및-갱신)
2. [인증 흐름도](#인증-흐름도)
   - [로그인 프로세스](#로그인-프로세스)
   - [토큰 갱신 메커니즘](#토큰-갱신-메커니즘)
   - [세션 만료 처리](#세션-만료-처리)

## 대시보드 워크플로우

### 초기 로드 시나리오

1. 사용자가 대시보드 URL로 접근하면 인증 상태를 확인합니다:
   - 인증되지 않은 경우: 로그인 페이지로 리다이렉트 후 `returnUrl` 파라미터 설정
   - 인증된 경우: 대시보드 레이아웃 및 컴포넌트 로드 진행

2. 대시보드 초기화 프로세스:
   - 레이아웃 컴포넌트 마운트
   - 사용자 프로필 정보 로드
   - 주요 데이터 요약 컴포넌트 로드
   - 사이드바 권한 기반 메뉴 구성

### 컴포넌트 상호작용

1. 사이드바 네비게이션:
   - 메뉴 항목 클릭 시 해당 섹션으로 라우팅 변경
   - 활성 메뉴 시각적 표시 및 유지
   - 권한 기반 메뉴 필터링 (관리자/일반 사용자)

2. 대시보드 카드 상호작용:
   - 카드 확장/축소 기능
   - 데이터 필터링 및 정렬 기능
   - 상세 정보 모달 표시 기능

3. 사용자 프로필 드롭다운:
   - 계정 설정 접근
   - 알림 센터 표시
   - 로그아웃 기능

### 데이터 요청 및 갱신

1. 초기 데이터 로드:
   - 병렬 API 요청으로 필수 데이터 동시 로드
   - 로딩 상태 표시 및 에러 처리
   - 캐싱 전략 적용 (stale-while-revalidate)

2. 실시간 데이터 갱신:
   - 폴링 또는 웹소켓을 통한 주요 지표 실시간 업데이트
   - 사용자 활동 기반 데이터 리프레시 전략
   - 백그라운드 데이터 갱신 및 UI 반영

3. 상호작용 기반 데이터 요청:
   - 페이지네이션, 필터링, 정렬 시 API 요청 최적화
   - 요청 디바운싱 및 쓰로틀링 적용
   - 캐시 무효화 및 강제 리프레시 메커니즘

## 인증 흐름도

### 로그인 프로세스

1. 사용자 인증 단계:
   ```
   [로그인 폼] → [자격 증명 검증] → [토큰 발급] → [상태 저장] → [리다이렉트]
   ```

2. 세부 프로세스:
   - 사용자가 이메일/비밀번호 입력
   - `authService.login()` 호출 및 백엔드 검증
   - 성공 시 액세스/리프레시 토큰 수신
   - 토큰 저장 및 인증 상태 갱신
   - 의도한 페이지 또는 대시보드로 리다이렉트

### 토큰 갱신 메커니즘

1. 자동 갱신 흐름:
   ```
   [API 요청] → [401 에러 감지] → [토큰 갱신 요청] → [새 토큰 저장] → [원래 요청 재시도]
   ```

2. 토큰 상태 관리:
   - 액세스 토큰: 메모리 및 로컬 스토리지에 저장
   - 리프레시 토큰: HTTP-Only 쿠키로 관리
   - 토큰 만료 시간 트래킹 및 사전 갱신 최적화

3. 동시 요청 처리:
   - 토큰 갱신 중 발생한 모든 API 요청 큐 관리
   - 갱신 성공 후 대기 중인 요청 일괄 처리
   - 갱신 실패 시 모든 대기 요청 거부 및 인증 실패 처리

### 세션 만료 처리

1. 리프레시 토큰 만료 시나리오:
   ```
   [토큰 갱신 실패] → [로그아웃 처리] → [세션 정보 삭제] → [로그인 페이지 리다이렉트]
   ```

2. 사용자 경험 최적화:
   - 세션 만료 직전 사용자에게 알림 표시 (선택사항)
   - 재인증 요구 시 현재 상태 보존
   - 로그인 후 이전 작업 컨텍스트로 복귀

3. 보안 고려사항:
   - 다중 디바이스 로그인 감지 및 처리
   - 비정상적 요청 패턴 감지 시 강제 재인증
   - 중요 작업 수행 시 추가 인증 요구 메커니즘